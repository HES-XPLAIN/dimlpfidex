<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Program Listing for File fidexGloStatsFct.cpp &mdash; dimlpfidex 0.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css?v=a885cde7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=7026087e"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js?v=73120307"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js?v=660e4f45"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            dimlpfidex
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">C++ API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="library_root.html">Library API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/modules.html">trainings</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dimlpfidex</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Program Listing for File fidexGloStatsFct.cpp</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/program_listing_file__home_runner_work_dimlpfidex_dimlpfidex_fidex_cpp_src_fidexGloStatsFct.cpp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="program-listing-for-file-fidexglostatsfct-cpp">
<span id="program-listing-file-home-runner-work-dimlpfidex-dimlpfidex-fidex-cpp-src-fidexglostatsfct-cpp"></span><h1>Program Listing for File fidexGloStatsFct.cpp<a class="headerlink" href="#program-listing-for-file-fidexglostatsfct-cpp" title="Link to this heading"></a></h1>
<p>↰ <a class="reference internal" href="file__home_runner_work_dimlpfidex_dimlpfidex_fidex_cpp_src_fidexGloStatsFct.cpp.html#file-home-runner-work-dimlpfidex-dimlpfidex-fidex-cpp-src-fidexglostatsfct-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">/home/runner/work/dimlpfidex/dimlpfidex/fidex/cpp/src/fidexGloStatsFct.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;fidexGloStatsFct.h&quot;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">showStatsParams</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;---------------------------------------------------------------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Warning! The files are located with respect to the root folder dimlpfidex.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;The arguments can be specified in the command or in a json configuration file with --json_config_file your_config_file.json.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----------------------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Required parameters:&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--test_data_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file containing the test portion of the dataset&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--test_class_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file containing the test true classes of the dataset, not mandatory if classes are specified in test data file&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--test_pred_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file containing predictions on the test portion of the dataset&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--global_rules_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file containing the global rules obtained with fidexGloRules algorithm.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--nb_attributes &lt;int [1,inf[&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of attributes in the dataset&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--nb_classes &lt;int [2,inf[&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Number of classes in the dataset&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----------------------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Optional parameters: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--json_config_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the JSON file that configures all parameters. If used, this must be the sole argument and must specify the file&#39;s relative path&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--root_folder &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the folder, based on main default folder dimlpfidex, containing all used files and where generated files will be saved. If a file name is specified with another option, its path will be relative to this root folder&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--global_rules_outfile &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file where the output global rules will be stored with stats on test set, if you want to compute those statistics.&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--attributes_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file containing the labels of attributes and classes&gt; Mandatory if rules file contains attribute names, if not, do not add it&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--stats_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file where statistics of the global ruleset will be stored&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--console_file &lt;str&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Path to the file where the terminal output will be redirected. If not specified, all output will be shown on your terminal&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">printOptionDescription</span><span class="p">(</span><span class="s">&quot;--positive_class_index &lt;int [0,nb_classes-1]&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Index of the positive class to compute true/false positive/negative rates, index starts at 0. If it is specified in the rules file, it has to be the same value.&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;----------------------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Execution example :&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;fidex.fidexGloStats(</span><span class="se">\&quot;</span><span class="s">--test_data_file datanormTest.txt --test_pred_file predTest.out --test_class_file dataclass2Test.txt --global_rules_file globalRules.rls --nb_attributes 16 --nb_classes 2 --stats_file stats.txt --root_folder dimlp/datafiles</span><span class="se">\&quot;</span><span class="s">)&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;---------------------------------------------------------------------&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">            </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">getCovering</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sampleIds</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Rule</span><span class="w"> </span><span class="o">&amp;</span><span class="n">rule</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">testValues</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Get covering index samples</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">attr</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">ineq</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">val</span><span class="p">;</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">testValues</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">id</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">notCovered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">antecedent</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rule</span><span class="p">.</span><span class="n">getAntecedents</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// For each antecedent</span>
<span class="w">      </span><span class="n">attr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">antecedent</span><span class="p">.</span><span class="n">getAttribute</span><span class="p">();</span>
<span class="w">      </span><span class="n">ineq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">antecedent</span><span class="p">.</span><span class="n">getInequality</span><span class="p">();</span>
<span class="w">      </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">antecedent</span><span class="p">.</span><span class="n">getValue</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ineq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">testValues</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// If the inequality is not verified</span>
<span class="w">        </span><span class="n">notCovered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ineq</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">testValues</span><span class="p">[</span><span class="n">id</span><span class="p">][</span><span class="n">attr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">notCovered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">notCovered</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">sampleIds</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">computeTFPN</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">decision</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nbTruePositive</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nbFalsePositive</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nbTrueNegative</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nbFalseNegative</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decision</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Positive prediction</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decision</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">nbFalsePositive</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Negative prediction</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">testTrueClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">nbFalseNegative</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">nbTrueNegative</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">checkStatsParametersLogicValues</span><span class="p">(</span><span class="n">Parameters</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// setting default values</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">setDefaultInt</span><span class="p">(</span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// this sections check if values comply with program logic</span>

<span class="w">  </span><span class="c1">// asserting mandatory parameters</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">assertStringExists</span><span class="p">(</span><span class="n">TEST_DATA_FILE</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">assertStringExists</span><span class="p">(</span><span class="n">TEST_PRED_FILE</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">assertStringExists</span><span class="p">(</span><span class="n">GLOBAL_RULES_FILE</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">assertIntExists</span><span class="p">(</span><span class="n">NB_ATTRIBUTES</span><span class="p">);</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">assertIntExists</span><span class="p">(</span><span class="n">NB_CLASSES</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// verifying logic between parameters, values range and so on...</span>
<span class="w">  </span><span class="n">p</span><span class="p">.</span><span class="n">checkAttributeAndClassCounts</span><span class="p">();</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;Error : Positive class index must be positive (&gt;=0)&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">NB_CLASSES</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;Error : The index of positive class cannot be greater or equal to the number of classes (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">getInt</span><span class="p">(</span><span class="n">NB_CLASSES</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;).&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">fidexGloStats</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Save buffer where we output results</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">ofs</span><span class="p">;</span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">streambuf</span><span class="w"> </span><span class="o">*</span><span class="n">cout_buff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span><span class="w"> </span><span class="c1">// Save old buf</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">temps</span><span class="p">;</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
<span class="w">    </span><span class="kt">clock_t</span><span class="w"> </span><span class="n">t2</span><span class="p">;</span>

<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Parsing the command</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">commandList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;fidexGloStats&quot;</span><span class="p">};</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ss</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">commandList</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">nbParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandList</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nbParam</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">commandList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">commandList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;--help&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">showStatsParams</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Import parameters</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Parameters</span><span class="o">&gt;</span><span class="w"> </span><span class="n">params</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">ParameterCode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">validParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">TEST_DATA_FILE</span><span class="p">,</span><span class="w"> </span><span class="n">TEST_PRED_FILE</span><span class="p">,</span><span class="w"> </span><span class="n">TEST_CLASS_FILE</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">GLOBAL_RULES_FILE</span><span class="p">,</span><span class="w"> </span><span class="n">GLOBAL_RULES_OUTFILE</span><span class="p">,</span><span class="w"> </span><span class="n">NB_ATTRIBUTES</span><span class="p">,</span><span class="w"> </span><span class="n">NB_CLASSES</span><span class="p">,</span><span class="w"> </span><span class="n">ROOT_FOLDER</span><span class="p">,</span><span class="w"> </span><span class="n">ATTRIBUTES_FILE</span><span class="p">,</span>
<span class="w">                                              </span><span class="n">STATS_FILE</span><span class="p">,</span><span class="w"> </span><span class="n">GLOBAL_RULES_OUTFILE</span><span class="p">,</span><span class="w"> </span><span class="n">CONSOLE_FILE</span><span class="p">,</span><span class="w"> </span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">};</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">commandList</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">compare</span><span class="p">(</span><span class="s">&quot;--json_config_file&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">commandList</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;JSON config file name/path is missing&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">commandList</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;Option &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">commandList</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; has to be the only option in the command if specified.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Parameters</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Parameters</span><span class="p">(</span><span class="n">commandList</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">validParams</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">out_of_range</span><span class="w"> </span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;Some value inside your JSON config file &#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">commandList</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&#39; is out of range.</span><span class="se">\n</span><span class="s">(Probably due to a too large or too tiny numeric value).&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">msg</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">());</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown JSON config file error: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="c1">// Read parameters from CLI</span>
<span class="w">      </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Parameters</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Parameters</span><span class="p">(</span><span class="n">commandList</span><span class="p">,</span><span class="w"> </span><span class="n">validParams</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// getting all program arguments from CLI</span>
<span class="w">    </span><span class="n">checkStatsParametersLogicValues</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get console results to file</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">isStringSet</span><span class="p">(</span><span class="n">CONSOLE_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">consoleFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">CONSOLE_FILE</span><span class="p">);</span>
<span class="w">      </span><span class="n">ofs</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">consoleFile</span><span class="p">);</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">ofs</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">());</span><span class="w"> </span><span class="c1">// redirect std::cout to file</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Show chosen parameters</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">params</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ----------------------------------------------------------------------</span>

<span class="w">    </span><span class="c1">// Get parameters values</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbAttributes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">(</span><span class="n">NB_ATTRIBUTES</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">(</span><span class="n">NB_CLASSES</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">testDataFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">TEST_DATA_FILE</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">testDataFilePred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">TEST_PRED_FILE</span><span class="p">);</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">rulesFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">GLOBAL_RULES_FILE</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Get decision threshold and positive class index</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">;</span>
<span class="w">    </span><span class="n">getThresholdFromRulesFile</span><span class="p">(</span><span class="n">rulesFile</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">positiveClassIndexParam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getInt</span><span class="p">(</span><span class="n">POSITIVE_CLASS_INDEX</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndexParam</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">positiveClassIndexParam</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;The positive class index must be the same as the one specified in the rules file (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;).&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">positiveClassIndexParam</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// ----------------------------------------------------------------------</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Importing files...&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Get test data</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">DataSetFid</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testDatas</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">isStringSet</span><span class="p">(</span><span class="n">TEST_CLASS_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">testDatas</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DataSetFid</span><span class="p">(</span><span class="s">&quot;testDatas from FidexGloStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">testDataFile</span><span class="p">,</span><span class="w"> </span><span class="n">testDataFilePred</span><span class="p">,</span><span class="w"> </span><span class="n">nbAttributes</span><span class="p">,</span><span class="w"> </span><span class="n">nbClasses</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getHasClasses</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CommandArgumentException</span><span class="p">(</span><span class="s">&quot;The test true classes file has to be given with option --test_class_file or classes have to be given in the test data file.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">testDatas</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DataSetFid</span><span class="p">(</span><span class="s">&quot;testDatas from FidexGloStats&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">testDataFile</span><span class="p">,</span><span class="w"> </span><span class="n">testDataFilePred</span><span class="p">,</span><span class="w"> </span><span class="n">nbAttributes</span><span class="p">,</span><span class="w"> </span><span class="n">nbClasses</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">TEST_CLASS_FILE</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">testData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getDatas</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">testPreds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getPredictions</span><span class="p">();</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">testTrueClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getClasses</span><span class="p">();</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">testOutputValuesPredictions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getOutputValuesPredictions</span><span class="p">();</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbTestData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getNbSamples</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Get attributes</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">attributeNames</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">classNames</span><span class="p">;</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasClassNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">isStringSet</span><span class="p">(</span><span class="n">ATTRIBUTES_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">setAttributes</span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">ATTRIBUTES_FILE</span><span class="p">),</span><span class="w"> </span><span class="n">nbAttributes</span><span class="p">,</span><span class="w"> </span><span class="n">nbClasses</span><span class="p">);</span>
<span class="w">      </span><span class="n">attributeNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getAttributeNames</span><span class="p">();</span>
<span class="w">      </span><span class="n">hasClassNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getHasClassNames</span><span class="p">();</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasClassNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">classNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testDatas</span><span class="o">-&gt;</span><span class="n">getClassNames</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Get rules</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lines</span><span class="p">;</span><span class="w">                             </span><span class="c1">// Lines for the output stats</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;Global statistics of the rule set : &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Lines for the output stats</span>

<span class="w">    </span><span class="c1">// Get statistic line at the top of the rulesfile</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">statsLine</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">fstream</span><span class="w"> </span><span class="n">rulesData</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Rule</span><span class="o">&gt;</span><span class="w"> </span><span class="n">rules</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rulesFile</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">rulesFile</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;json&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Rule</span><span class="o">::</span><span class="n">fromJsonFile</span><span class="p">(</span><span class="n">rulesFile</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">);</span>

<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">meanCovering</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">meanNbAntecedentsPerRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">nbRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rules</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Rule</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rules</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">meanCovering</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">getCoveredSamples</span><span class="p">().</span><span class="n">size</span><span class="p">());</span>
<span class="w">        </span><span class="n">meanNbAntecedentsPerRule</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">getAntecedents</span><span class="p">().</span><span class="n">size</span><span class="p">());</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">meanCovering</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbRules</span><span class="p">;</span>
<span class="w">      </span><span class="n">meanNbAntecedentsPerRule</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbRules</span><span class="p">;</span>

<span class="w">      </span><span class="n">statsLine</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Number of rules : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbRules</span><span class="p">);</span>
<span class="w">      </span><span class="n">statsLine</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;, mean sample covering number per rule : &quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">statsLine</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">meanCovering</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, mean number of antecedents per rule : &quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">statsLine</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">meanNbAntecedentsPerRule</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">rulesData</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">rulesFile</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">in</span><span class="p">);</span><span class="w"> </span><span class="c1">// Read data file</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rulesData</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">FileNotFoundError</span><span class="p">(</span><span class="s">&quot;Error : file &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rulesFile</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; not found.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">getline</span><span class="p">(</span><span class="n">rulesData</span><span class="p">,</span><span class="w"> </span><span class="n">statsLine</span><span class="p">);</span>
<span class="w">      </span><span class="n">statsLine</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">      </span><span class="n">getRules</span><span class="p">(</span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">rulesFile</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">testDatas</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">statsLine</span><span class="p">);</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Data imported.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Compute global statistics on test set</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Compute statistics...&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span>
<span class="w">              </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">fidelity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">       </span><span class="c1">// Global rule fidelity rate (wrong only if there is activated rules but no correct one(with respect to prediction))</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">accuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">       </span><span class="c1">// Global rule accuracy (true if there is at least one fidel activated rule and the model is right, or if there is no activated rules and the model is right or if all the activated rules decide the same class and this class is the true one)</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">explainabilityRate</span><span class="p">;</span><span class="w"> </span><span class="c1">// True if there is an activated rule</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">explainabilityTotal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">defaultRuleRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">             </span><span class="c1">// True if there is no activated rule</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">meanNbCorrectActivatedRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Mean number of correct activated rules per sample</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">meanNbWrongActivatedRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">   </span><span class="c1">// Mean number of wrong activated rules per sample</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbActivatedRulesAndModelAgree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">accuracyWhenActivatedRulesAndModelAgree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Model accuracy when activated rules and model agree (sample has correct activated rules or no activated rules, then percentage of good predictions on them by the model)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbFidelRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">accuracyWhenRulesAndModelAgree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Model accuracy when activated rules and model agree (sample has correct activated rules, then percentage of good predictions on them by the model)</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">modelAccuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">testValues</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">testPred</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Correct positive prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbTrueNegative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Correct negative prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbFalsePositive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Wrong positive prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbFalseNegative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Wrong negative prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbPositive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbNegative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbTruePositiveRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Correct positive rule prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbTrueNegativeRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Correct negative rule prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbFalsePositiveRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Wrong positive rule prediction</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">nbFalseNegativeRules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Wrong negative rule prediction</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span><span class="w"> </span><span class="n">t</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// For each test value</span>
<span class="w">      </span><span class="n">testValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testData</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
<span class="w">      </span><span class="n">testPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testPreds</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
<span class="w">      </span><span class="n">testTrueClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testTrueClasses</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">testTrueClass</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">nbPositive</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">nbNegative</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">testPred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">modelAccuracy</span><span class="o">++</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">computeTFPN</span><span class="p">(</span><span class="n">testPred</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">,</span><span class="w"> </span><span class="n">nbTruePositive</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalsePositive</span><span class="p">,</span><span class="w"> </span><span class="n">nbTrueNegative</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalseNegative</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="c1">// Find rules activated by this sample</span>
<span class="w">      </span><span class="kt">bool</span><span class="w"> </span><span class="n">noCorrectRuleWithAllSameClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// If there is no correct rule activated but all rules have same class</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">activatedRules</span><span class="p">;</span>
<span class="w">      </span><span class="n">getActivatedRules</span><span class="p">(</span><span class="n">activatedRules</span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">testValues</span><span class="p">);</span>

<span class="w">      </span><span class="c1">// Check which rules are correct</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">correctRules</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activatedRules</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// If there is no activated rule -&gt; we would launch Fidex and so it will be fidel</span>
<span class="w">        </span><span class="n">defaultRuleRate</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="n">fidelity</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// It is true to the model because we choose his prediction</span>
<span class="w">        </span><span class="n">nbFidelRules</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">testPred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// If the model is right, it&#39;s true for the accuracy</span>
<span class="w">          </span><span class="n">accuracy</span><span class="o">++</span><span class="p">;</span>
<span class="w">          </span><span class="n">accuracyWhenRulesAndModelAgree</span><span class="o">++</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// There is some activated rules</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">activatedRules</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">getOutputClass</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testPred</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Check if the class of the rule is the predicted one</span>
<span class="w">            </span><span class="n">correctRules</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">correctRules</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// If there is no correct rule</span>
<span class="w">          </span><span class="n">meanNbWrongActivatedRules</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activatedRules</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

<span class="w">          </span><span class="kt">int</span><span class="w"> </span><span class="n">ancientClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rules</span><span class="p">[</span><span class="n">activatedRules</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">getOutputClass</span><span class="p">();</span>
<span class="w">          </span><span class="kt">bool</span><span class="w"> </span><span class="n">allSameClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Check if all the rules choose the same class</span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">activatedRules</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="n">v</span><span class="p">].</span><span class="n">getOutputClass</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ancientClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">allSameClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">              </span><span class="k">break</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">allSameClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">explainabilityTotal</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// If all decisions are the same, we have an explanation</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">decision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rules</span><span class="p">[</span><span class="n">activatedRules</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">getOutputClass</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decision</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// If those decisions are the true class, this is accurate</span>
<span class="w">              </span><span class="n">accuracy</span><span class="o">++</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// The rules&#39; decision is different from the model&#39;s</span>
<span class="w">            </span><span class="n">noCorrectRuleWithAllSameClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">computeTFPN</span><span class="p">(</span><span class="n">decision</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">,</span><span class="w"> </span><span class="n">nbTruePositiveRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalsePositiveRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbTrueNegativeRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalseNegativeRules</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// There is an explanation which is caracterised by the correct rules</span>

<span class="w">          </span><span class="n">fidelity</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// It is true to the model because we found a correct activated rule</span>
<span class="w">          </span><span class="n">explainabilityTotal</span><span class="o">++</span><span class="p">;</span>
<span class="w">          </span><span class="n">nbActivatedRulesAndModelAgree</span><span class="o">++</span><span class="p">;</span>
<span class="w">          </span><span class="n">nbFidelRules</span><span class="o">++</span><span class="p">;</span>
<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">testPred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">accuracy</span><span class="o">++</span><span class="p">;</span><span class="w">                                </span><span class="c1">// If the model is right, it&#39;s true for the accuracy because we found a fidel rule</span>
<span class="w">            </span><span class="n">accuracyWhenActivatedRulesAndModelAgree</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="c1">// It is true for the accuracy because prediction is correct</span>
<span class="w">            </span><span class="n">accuracyWhenRulesAndModelAgree</span><span class="o">++</span><span class="p">;</span><span class="w">          </span><span class="c1">// It is true for the accuracy because prediction is correct</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="n">meanNbCorrectActivatedRules</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">correctRules</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">          </span><span class="n">meanNbWrongActivatedRules</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">activatedRules</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">correctRules</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">noCorrectRuleWithAllSameClass</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// The rules&#39; decision is the same as the model&#39;s, if we can find a correct rule or if we need to compute Fidex</span>
<span class="w">        </span><span class="n">computeTFPN</span><span class="p">(</span><span class="n">testPred</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">,</span><span class="w"> </span><span class="n">testTrueClass</span><span class="p">,</span><span class="w"> </span><span class="n">nbTruePositiveRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalsePositiveRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbTrueNegativeRules</span><span class="p">,</span><span class="w"> </span><span class="n">nbFalseNegativeRules</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">fidelity</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">accuracy</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">explainabilityRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">explainabilityTotal</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">defaultRuleRate</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">meanNbCorrectActivatedRules</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">meanNbWrongActivatedRules</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">modelAccuracy</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbTestData</span><span class="p">;</span>
<span class="w">    </span><span class="n">accuracyWhenRulesAndModelAgree</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbFidelRules</span><span class="p">;</span>
<span class="w">    </span><span class="n">accuracyWhenActivatedRulesAndModelAgree</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">nbActivatedRulesAndModelAgree</span><span class="p">;</span>

<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;Statistics with a test set of &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbTestData</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; samples :</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decisionThreshold</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;No decision threshold is used.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;No positive index class is used.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;Positive index class used : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="p">));</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;Using a decision threshold of &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">decisionThreshold</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; for class &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The global rule fidelity rate is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">fidelity</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The global rule accuracy is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">accuracy</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The explainability rate (when we can find one or more rules, either correct ones or activated ones which all agree on the same class) is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">explainabilityRate</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The default rule rate (when we can&#39;t find any rule activated for a sample) is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">defaultRuleRate</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The mean number of correct(fidel) activated rules per sample is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">meanNbCorrectActivatedRules</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The mean number of wrong(not fidel) activated rules per sample is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">meanNbWrongActivatedRules</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The model test accuracy is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">modelAccuracy</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The model test accuracy when rules and model agree is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">accuracyWhenRulesAndModelAgree</span><span class="p">));</span>
<span class="w">    </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The model test accuracy when activated rules and model agree is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">accuracyWhenActivatedRulesAndModelAgree</span><span class="p">));</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hasClassNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">With positive class &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">classNames</span><span class="p">[</span><span class="n">positiveClassIndex</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; :&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">With positive class &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">positiveClassIndex</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; :&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Computation with model decision :&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of true positive test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbTruePositive</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of false positive test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbFalsePositive</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of true negative test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbTrueNegative</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of false negative test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbFalseNegative</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The false positive rate is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbNegative</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbFalsePositive</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbNegative</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The false negative rate is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbPositive</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbFalseNegative</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbPositive</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The precision is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalsePositive</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbTruePositive</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalsePositive</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The recall is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalseNegative</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbTruePositive</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbTruePositive</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalseNegative</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>

<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Computation with rules decision :&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of true positive test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbTruePositiveRules</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of false positive test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbFalsePositiveRules</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of true negative test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbTrueNegativeRules</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The number of false negative test samples is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">nbFalseNegativeRules</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The false positive rate is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbNegative</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbFalsePositiveRules</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbNegative</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The false negative rate is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbPositive</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbFalseNegativeRules</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbPositive</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The precision is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbTruePositiveRules</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalsePositiveRules</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbTruePositiveRules</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbTruePositiveRules</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalsePositiveRules</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">      </span><span class="n">lines</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="s">&quot;The recall is : &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="n">nbTruePositiveRules</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalseNegativeRules</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">nbTruePositiveRules</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">nbTruePositiveRules</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">nbFalseNegativeRules</span><span class="p">))</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;N/A&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Output statistics</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">isStringSet</span><span class="p">(</span><span class="n">STATS_FILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">outputFile</span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">STATS_FILE</span><span class="p">));</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">outputFile</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">line</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">outputFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">CannotOpenFileError</span><span class="p">(</span><span class="s">&quot;Error : Couldn&#39;t open explanation extraction file &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">STATS_FILE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Compute rules statistics on test set</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">isStringSet</span><span class="p">(</span><span class="n">GLOBAL_RULES_OUTFILE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">ruleFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">GLOBAL_RULES_OUTFILE</span><span class="p">);</span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ruleFile</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">ruleFile</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;json&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Rule</span><span class="o">::</span><span class="n">toJsonFile</span><span class="p">(</span><span class="n">ruleFile</span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="p">,</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="p">,</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="n">outputFile</span><span class="p">(</span><span class="n">ruleFile</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">outputFile</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">statsLine</span><span class="p">;</span>

<span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">decisionThreshold</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;No decision threshold is used.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Using a decision threshold of &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">decisionThreshold</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; for class &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">positiveClassIndex</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="w">          </span><span class="p">}</span>

<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rules</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">r</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// For each rule</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sampleIds</span><span class="p">;</span>
<span class="w">            </span><span class="n">getCovering</span><span class="p">(</span><span class="n">sampleIds</span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="w"> </span><span class="n">testData</span><span class="p">);</span>
<span class="w">            </span><span class="kt">size_t</span><span class="w"> </span><span class="n">coverSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sampleIds</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">ruleFidelity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">   </span><span class="c1">// porcentage of correct covered samples predictions with respect to the rule prediction</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">ruleAccuracy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">   </span><span class="c1">// porcentage of correct covered samples predictions with respect to the samples true class</span>
<span class="w">            </span><span class="kt">double</span><span class="w"> </span><span class="n">ruleConfidence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// mean output prediction score of covered samples</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">sampleId</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">sampleIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="kt">int</span><span class="w"> </span><span class="n">samplePred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testPreds</span><span class="p">[</span><span class="n">sampleId</span><span class="p">];</span>
<span class="w">              </span><span class="kt">double</span><span class="w"> </span><span class="n">sampleOutputPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">              </span><span class="kt">int</span><span class="w"> </span><span class="n">classRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rules</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">getOutputClass</span><span class="p">();</span>
<span class="w">              </span><span class="n">sampleOutputPred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testOutputValuesPredictions</span><span class="p">[</span><span class="n">sampleId</span><span class="p">][</span><span class="n">classRule</span><span class="p">];</span>
<span class="w">              </span><span class="kt">int</span><span class="w"> </span><span class="n">rulePred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rules</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">getOutputClass</span><span class="p">();</span>
<span class="w">              </span><span class="kt">int</span><span class="w"> </span><span class="n">trueClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testTrueClasses</span><span class="p">[</span><span class="n">sampleId</span><span class="p">];</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">samplePred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">rulePred</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ruleFidelity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">samplePred</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">trueClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ruleAccuracy</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">              </span><span class="p">}</span>
<span class="w">              </span><span class="n">ruleConfidence</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">sampleOutputPred</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">coverSize</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">ruleFidelity</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">coverSize</span><span class="p">);</span>
<span class="w">              </span><span class="n">ruleAccuracy</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">coverSize</span><span class="p">);</span>
<span class="w">              </span><span class="n">ruleConfidence</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">coverSize</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">trainStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">splitString</span><span class="p">(</span><span class="n">rules</span><span class="p">[</span><span class="n">r</span><span class="p">].</span><span class="n">toString</span><span class="p">(</span><span class="n">attributeNames</span><span class="p">,</span><span class="w"> </span><span class="n">classNames</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">                       </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Rule &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; --- Test Covering size : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">coverSize</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">coverSize</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; --- Test Fidelity : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">formattingDoubleToString</span><span class="p">(</span><span class="n">ruleFidelity</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; --- Test Accuracy : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">formattingDoubleToString</span><span class="p">(</span><span class="n">ruleAccuracy</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">trainStats</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; --- Test Confidence : &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">formattingDoubleToString</span><span class="p">(</span><span class="n">ruleConfidence</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">              </span><span class="n">outputFile</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">          </span><span class="p">}</span>
<span class="w">          </span><span class="n">outputFile</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="n">CannotOpenFileError</span><span class="p">(</span><span class="s">&quot;Error : Couldn&#39;t open global rules file with statistics on test set &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">params</span><span class="o">-&gt;</span><span class="n">getString</span><span class="p">(</span><span class="n">GLOBAL_RULES_OUTFILE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clock</span><span class="p">();</span>
<span class="w">    </span><span class="n">temps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)(</span><span class="n">t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">CLOCKS_PER_SEC</span><span class="p">;</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Full execution time = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">temps</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; sec&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">cout_buff</span><span class="p">);</span><span class="w"> </span><span class="c1">// reset to standard output again</span>

<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ErrorHandler</span><span class="w"> </span><span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">(</span><span class="n">cout_buff</span><span class="p">);</span><span class="w"> </span><span class="c1">// reset to standard output again</span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, HES-XPLAIN.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>